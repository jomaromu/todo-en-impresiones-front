<div id="wrap-pedido">

    <ul class="nav nav-tabs nav-fill" id="tab-pedido" role="tablist">

        <!-- informacion -->
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab"
                aria-selected="true">
                <i class="fas fa-info-circle"></i>
                Información
            </button>
        </li>

        <!-- producto -->
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#producto" type="button" role="tab"
                aria-selected="false">
                <i class="fas fa-box-open"></i>
                Producto
            </button>
        </li>

        <!-- archivos -->
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#archivos" type="button" role="tab"
                aria-selected="false">
                <i class="fas fa-file-alt"></i>
                Archivos
            </button>
        </li>

        <!-- seguimiento -->
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#seguimiento" type="button" role="tab"
                aria-selected="false">
                <i class="fas fa-road"></i>
                Seguimiento
            </button>
        </li>

        <!-- pagos -->
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pagos" type="button" role="tab"
                aria-selected="false">
                <i class="fas fa-money-check-alt"></i>
                Pagos
            </button>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent" style="position: relative;">

        <!-- Informacion -->
        <div class="tab-pane fade show active" id="info" role="tabpanel">
            <div class="wrapper-tap" id="tap-informacion">

                <!-- informacion cliente -->
                <div id="info-cliente" class="wrap-info">
                    <h6>Información de cliente</h6>
                    <div class="wrap-inputs">
                        <div>
                            <label for="nombre" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre" [value]="pedido?.cliente.nombre"
                                disabled>
                        </div>
                        <div>
                            <label for="nombre" class="form-label">Teléfono:</label>
                            <input type="text" class="form-control" id="telefono" [value]="pedido?.cliente.telefono"
                                disabled>
                        </div>
                        <div
                            *ngIf="pedido?.cliente.client_role === 'EmpresaRole' || pedido?.cliente.client_role === 'EmpresaVIPRole'">
                            <label for="nombre" class="form-label">RUC:</label>
                            <input type="text" class="form-control" id="ruc" [value]="pedido?.cliente.ruc" disabled>
                        </div>

                    </div>
                </div>

                <!-- informacion pedido -->
                <div id="info-pedido" class="wrap-info">
                    <h6>Información de pedido</h6>
                    <form [formGroup]="forma" id="formulario" (ngSubmit)="actualizarInfo()">


                        <!-- fecha registro -->
                        <div>
                            <label class="form-label">Fecha registro:</label>
                            <input type="date" class="form-control" [value]="pedido?.fecha_alta"
                                style="cursor: no-drop;" id="fecha-registro" formControlName="fechaRegistro">
                        </div>

                        <!-- fecha entrega -->
                        <div>
                            <label class="form-label">Fecha entrega:</label>
                            <input type="date" class="form-control" [value]="fechaEntrega" id="fecha_entrega"
                                formControlName="fechaEntrega">
                        </div>

                        <!-- prioridad -->
                        <div>
                            <label class="form-label">Prioridad:</label>
                            <select class="form-select" formControlName="prioridad">
                                <option *ngFor="let item of prioridadesPedido" [value]="item.importancia">
                                    {{item.nombre}}
                                </option>
                            </select>
                        </div>

                        <!-- etapa -->
                        <div>
                            <label class="form-label">Etapa pedido:</label>
                            <select class="form-select" formControlName="etapaPedido">
                                <option *ngFor="let item of etapasPedido" [value]="item.id">
                                    {{item.nombre}}
                                </option>
                            </select>
                        </div>

                        <!-- diseniador -->
                        <div>
                            <label class="form-label">
                                Diseñador:
                                <i class="fas fa-feather-alt" role="button" (click)="cargarDistribucion()"></i>
                            </label>
                            <select class="form-select" formControlName="diseniador">
                                <option *ngFor="let diseniador of diseniadores" [value]="diseniador._id">
                                    {{diseniador.nombre}} {{diseniador.apellido}}</option>
                            </select>
                        </div>

                        <!-- estado -->
                        <div>
                            <label class="form-label">Estado pedido:</label>
                            <select class="form-select" formControlName="estadoPedido">
                                <option *ngFor="let item of estadosPedido" [value]="item.id">
                                    {{item.nombre}}
                                </option>
                            </select>
                        </div>

                        <!-- origen -->
                        <div>
                            <label class="form-label">Origen venta:</label>
                            <select class="form-select" formControlName="origenVenta">
                                <option *ngFor="let origen of origenes?.origenesDB" [value]="origen._id">
                                    {{origen.nombre}}
                                </option>
                            </select>
                        </div>

                        <!-- vendedor -->
                        <div>
                            <label class="form-label">Vendedor:</label>
                            <input type="text" class="form-control" [value]="vendedor" id="vendedor"
                                formControlName="vendedor" style="cursor: no-drop;">
                        </div>

                        <!-- sucursal -->
                        <div>
                            <label class="form-label">Sucursal:</label>
                            <select class="form-select" formControlName="sucursal">
                                <option *ngFor="let sucursal of sucursales" [value]="sucursal._id">{{sucursal.nombre}}
                                </option>
                            </select>
                        </div>

                        <!-- <span>
                            <i class="fas fa-feather-alt" role="button" (click)="cargarDistribucion()"></i>
                            Distribución
                        </span> -->

                        <!-- botones acciones -->
                        <div id="wrap-buttons-acciones">
                            <button class="buttons" type="submit">Guardar Cambios</button>

                            <div id="wrap-acciones">
                                <button class="buttons" type="button" data-bs-toggle="collapse"
                                    href="#collapse-acciones">Imprimir</button>

                                <div class="collapse multi-collapse" id="collapse-acciones">
                                    <div class="card card-body">
                                        <button>Imprimir factura</button>
                                        <button>Imprimir recibo</button>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Producto -->
        <div class="tab-pane fade" id="producto" role="tabpanel">
            <div class="wrapper-tap" id="tap-producto">
                <h6>Información de producto</h6>
                <form id="wrap-producto" [formGroup]="forma" (ngSubmit)="actualizarProducto()">
                    <div id="detalle-producto">
                        <!-- producto -->
                        <div id="wrap-input-producto" class="inputs-producto">
                            <label for="producto" class="form-label">
                                Producto:
                                <!-- <i class="far fa-eye" style="margin-left: 5px;" role="button"
                                    (click)="verPedidos()"></i> -->
                            </label>
                            <input type="text" class="form-control" [attr.data-idProducto]="producto?._id" id="producto"
                                formControlName="producto" (keyup)="detectarProducto($event)" autocomplete="off"
                                #inputProducto>
                            <div id="placeholder-producto" #placeHolderProducto>
                                <a role="button" (click)="agregarProducto(producto)"
                                    *ngFor="let producto of productos">{{producto.nombre}}</a>
                            </div>
                        </div>

                        <!-- comentario -->
                        <div id="wrap-input-comentario" class="inputs-producto">
                            <label for="comentario" class="form-label">Comentario:</label>
                            <textarea class="form-control" id="comentario" rows="4" style="resize: none;"
                                formControlName="comentario"></textarea>
                        </div>

                        <!-- cantidad -->
                        <div class="inputs-producto">
                            <label for="cantidad" class="form-label">Cantidad:</label>
                            <input type="number" class="form-control" id="cantidad" formControlName="cantidad">
                        </div>

                        <!-- precio -->
                        <div class="inputs-producto">
                            <label for="precio" class="form-label">Precio:</label>
                            <input type="number" class="form-control" id="precio" formControlName="precio">
                        </div>

                        <div class="inputs-producto itbms">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="itbms" formControlName="itbms"
                                    (change)="detectarItbms($event, pedido)" #checkItbms>
                                <label class="form-check-label" for="itbms">
                                    ITBMS
                                </label>
                            </div>
                        </div>

                        <div class="inputs-producto">
                            <button type="button" (click)="btnAgregar($event, pedido)"><i
                                    class="fas fa-cart-arrow-down"></i>
                                Agregar</button>
                        </div>
                    </div>
                    <div id="tabla-detalles-producto">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Comentario</th>
                                    <th>Total</th>
                                    <th>controles</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr *ngFor="let productoPedido of productosPedidos; let i = index">
                                    <td>{{i+1}}</td>
                                    <td>{{productoPedido?.producto.nombre}}</td>
                                    <td>{{productoPedido?.cantidad}}</td>
                                    <td>{{productoPedido?.precio | currency:'USD':'symbol'}}</td>
                                    <td>{{productoPedido?.comentario}}</td>
                                    <td>{{productoPedido?.total | currency:'USD':'symbol'}}</td>
                                    <td class="text-center">
                                        <i class="fas fa-trash-alt text-danger"
                                            (click)="eliminarProductoPedido(productoPedido, pedido)"
                                            style="cursor: pointer;"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="total-compra" *ngIf="objTotal.total !== 0">
                            <table class="table" style="max-width: 250px; width: 120px;">
                                <tbody>
                                    <tr>
                                        <th>Subtotal:</th>
                                        <th>{{objTotal.subtotal | currency:'USD':'symbol'}}</th>
                                    </tr>
                                    <tr>
                                        <th>ITBMS:</th>
                                        <th>{{objTotal.itbms | currency:'USD':'symbol'}}</th>
                                    </tr>
                                    <tr>
                                        <th>Total:</th>
                                        <th>{{objTotal.total | currency:'USD':'symbol'}}</th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="wrap-buttons-acciones">

                        <!-- botones acciones -->
                        <!-- <button class="buttons" type="submit">Guardar Cambios</button> -->
                        <span></span>

                        <div id="wrap-acciones">
                            <button class="buttons" type="button" data-bs-toggle="collapse"
                                href="#collapse-acciones">Imprimir</button>

                            <div class="collapse multi-collapse" id="collapse-acciones">
                                <div class="card card-body">
                                    <button>Imprimir factura</button>
                                    <button>Imprimir recibo</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Archivo -->
        <div class="tab-pane fade" id="archivos" role="tabpanel">
            <div class="wrapper-tap" id="tap-archivos">
                <h6>Información de archivos</h6>
                <div id="archivos">

                    <div id="wrap-tabla" class="mb-3">
                        <button (click)="addArchivo()">
                            <i class="fas fa-plus"></i>
                            Añadir archivo
                        </button>
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Creador</th>
                                    <th>Fecha de alta</th>
                                    <th>Tipo</th>
                                    <th>Enlace</th>
                                    <th>Controles</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr *ngFor="let archivo of archivo?.archivosDB">
                                    <td>{{archivo.nombre_archivo}}</td>
                                    <td>{{archivo.idCreador.nombre}} {{archivo.idCreador.apellido}}</td>
                                    <td>{{archivo.fecha}}</td>
                                    <td *ngIf="archivo.tipo === 0">Normal</td>
                                    <td *ngIf="archivo.tipo === 1">Corregir</td>
                                    <td *ngIf="archivo.tipo === 2">Aprobado</td>
                                    <td>
                                        <a [href]="archivo.nombre_archivo | enlaces" target="_blank">Abrir</a>
                                    </td>
                                    <td>
                                        <i class="fas fa-trash-alt text-danger"
                                            (click)="eliminarArchivo(archivo._id, pedido._id)" role="button"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
            <div id="wrap-buttons-acciones">

                <!-- botones acciones -->
                <!-- <button class="buttons" type="submit">Guardar Cambios</button> -->
                <span></span>

                <div id="wrap-acciones">
                    <button class="buttons" type="button" data-bs-toggle="collapse"
                        href="#collapse-acciones">Imprimir</button>

                    <div class="collapse multi-collapse" id="collapse-acciones">
                        <div class="card card-body">
                            <button>Imprimir factura</button>
                            <button>Imprimir recibo</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Seguimiento 4 -->
        <div class="tab-pane fade" id="seguimiento" role="tabpanel">
            <div class="wrapper-tap" id="tap-seguimiento" style="width: 99%;">
                <h6>Información seguimiento</h6>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio</th>
                            <th>Seg. Diseño</th>
                            <th>Seg. Producción</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let productoPedido of productosPedidos; let i = index">
                            <td>{{i+1}}</td>
                            <td>{{productoPedido?.producto.nombre}}</td>
                            <td>{{productoPedido?.cantidad}}</td>
                            <td>{{productoPedido?.precio | currency:'USD':'symbol'}}</td>
                            <td>
                                <div>
                                    <textarea class="form-control" id="seg-dise" rows="3"></textarea>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <textarea class="form-control" id="seg-prod" rows="3"></textarea>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- panel 5 -->
        <div class="tab-pane fade" id="pagos" role="tabpanel">Pag</div>
    </div>
</div>
<app-loading></app-loading>
<app-modal-data></app-modal-data>