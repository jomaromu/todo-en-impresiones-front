{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { first, take } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ngrx/store\";\nimport * as i3 from \"../../services/sucursal.service\";\nimport * as i4 from \"../../services/user.service\";\nimport * as i5 from \"../../services/pedido.service\";\nimport * as i6 from \"../../shared/busqueda/busqueda.component\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../shared/tabla-pedidos/tabla-pedidos.component\";\nconst _c0 = [\"selectUser\"];\n\nfunction MiBandejaComponent_div_12_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const bandeja_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", bandeja_r5.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", bandeja_r5.nombre, \"\");\n  }\n}\n\nfunction MiBandejaComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelementStart(1, \"label\", 16);\n    i0.ɵɵtext(2, \"Bandeja:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 17);\n    i0.ɵɵlistener(\"change\", function MiBandejaComponent_div_12_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.detectarUsuarios();\n    });\n    i0.ɵɵtemplate(4, MiBandejaComponent_div_12_option_4_Template, 2, 2, \"option\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.optBandeja);\n  }\n}\n\nfunction MiBandejaComponent_div_13_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const sucursal_r9 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", sucursal_r9._id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", sucursal_r9 == null ? null : sucursal_r9.nombre, \"\");\n  }\n}\n\nfunction MiBandejaComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelementStart(1, \"label\", 16);\n    i0.ɵɵtext(2, \"Sucursal:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 20);\n    i0.ɵɵlistener(\"change\", function MiBandejaComponent_div_13_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.detectarUsuarios();\n    });\n    i0.ɵɵtemplate(4, MiBandejaComponent_div_13_option_4_Template, 2, 2, \"option\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.sucursales == null ? null : ctx_r2.sucursales.sucursalesDB);\n  }\n}\n\nfunction MiBandejaComponent_div_14_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 19, 22);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const usuario_r13 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", usuario_r13._id);\n    i0.ɵɵattribute(\"data-userID\", usuario_r13._id)(\"data-userRole\", usuario_r13.colaborador_role);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", usuario_r13 == null ? null : usuario_r13.nombre, \" \", usuario_r13 == null ? null : usuario_r13.apellido, \"\");\n  }\n}\n\nfunction MiBandejaComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelementStart(1, \"label\", 16);\n    i0.ɵɵtext(2, \"Usuarios:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 21);\n    i0.ɵɵelementStart(4, \"option\", 19);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, MiBandejaComponent_div_14_option_6_Template, 3, 5, \"option\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r3.userFake.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r3.userFake.nombre);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.usuarios);\n  }\n}\n\nexport let MiBandejaComponent = /*#__PURE__*/(() => {\n  class MiBandejaComponent {\n    constructor(fb, store, sucursalService, userService, pedidoService) {\n      this.fb = fb;\n      this.store = store;\n      this.sucursalService = sucursalService;\n      this.userService = userService;\n      this.pedidoService = pedidoService;\n      this.userFake = {\n        id: 'null',\n        nombre: 'Todas'\n      };\n    }\n\n    ngOnInit() {\n      this.formularioFake();\n      this.crearFormulario();\n    }\n\n    crearFormulario() {\n      this.store.select('login').pipe(take(3)).subscribe(worker => {\n        if (worker.ok === true && worker.usuario.colaborador_role === 'SuperRole') {\n          this.role = worker.usuario.colaborador_role;\n          this.formularioAdmin();\n          this.cargarTodosPedidos();\n        }\n      });\n    }\n\n    seleccionarBandeja() {\n      this.optBandeja = [{\n        nombre: 'Todas',\n        id: 'null'\n      }, {\n        nombre: 'Producción',\n        id: 'prod'\n      }, {\n        nombre: 'Vendedor',\n        id: 'vend'\n      }, {\n        nombre: 'Diseñador',\n        id: 'dise'\n      }, {\n        nombre: 'Admin',\n        id: 'admin'\n      }];\n      this.forma.controls.selBandeja.setValue(this.optBandeja[0].id);\n    }\n\n    cargarSucursales() {\n      this.store.select('login').pipe(first()).subscribe(worker => {\n        this.sucursalService.obtenerSucursales(worker.token).pipe(first()).subscribe(sucursales => {\n          this.sucursales = sucursales;\n          const sucursalFake = {\n            _id: 'null',\n            nombre: 'Todas'\n          };\n          this.sucursales.sucursalesDB.unshift(sucursalFake);\n          this.forma.controls.sucursal.setValue(sucursales.sucursalesDB[0]._id);\n        });\n      });\n    }\n\n    detectarUsuarios() {\n      this.store.select('login').pipe(first()).subscribe(worker => {\n        let valBandeja = this.forma.controls.selBandeja.value;\n        let valSucursal = this.forma.controls.sucursal.value;\n\n        if (!valBandeja) {\n          valBandeja = 'null';\n        }\n\n        if (!valSucursal) {\n          valSucursal = 'null';\n        }\n\n        const data = {\n          role: valBandeja,\n          sucursal: valSucursal,\n          token: worker.token\n        }; // console.log(valBandeja);\n\n        this.userService.obtenerUsuarios(worker.token).pipe(first()).subscribe(resp => {\n          // console.log(resp.usuarios);\n          // return;\n          if (resp.usuarios.length === 0) {\n            this.forma.controls.usuarios.setValue('null');\n          } else {\n            switch (valBandeja) {\n              case 'dise':\n                this.usuarios = resp.usuarios.filter(usuario => {\n                  if (usuario.colaborador_role === 'DiseniadorRole') {\n                    return usuario;\n                  }\n                });\n                this.forma.controls.usuarios.setValue(this.usuarios[0]._id);\n                break;\n\n              case 'vend':\n                this.usuarios = resp.usuarios.filter(usuario => {\n                  if (usuario.colaborador_role === 'VendedorNormalRole' || usuario.colaborador_role === 'VendedorVIPRole') {\n                    return usuario;\n                  }\n                });\n                this.forma.controls.usuarios.setValue(this.usuarios[0]._id);\n                break;\n\n              default:\n                this.forma.controls.usuarios.setValue('null');\n                this.usuarios = [];\n            }\n          }\n        });\n      });\n    }\n\n    formularioAdmin() {\n      this.forma.controls.usuarios.setValue(this.userFake);\n      this.forma = this.fb.group({\n        selBandeja: ['null'],\n        sucursal: ['null'],\n        usuarios: ['null']\n      });\n      this.seleccionarBandeja();\n      this.cargarSucursales(); // this.cargarColaboradores();\n    }\n\n    aplicarFiltro(usuario) {\n      this.store.select('login').pipe(first()).subscribe(colaborador => __awaiter(this, void 0, void 0, function* () {\n        const valBandeja = this.forma.controls.selBandeja.value;\n        const valUser = this.forma.controls.usuarios.value;\n        const valSucursal = this.forma.controls.sucursal.value;\n        const data = {\n          token: colaborador.token,\n          bandejas: valBandeja,\n          userID: valUser,\n          colRole: valUser,\n          sucursal: valSucursal\n        }; // console.log(data);\n\n        if (data.bandejas !== 'null') {\n          data.bandejas = valBandeja;\n        }\n\n        if (valUser !== 'null') {\n          const dataUser = this.usuarios.find(user => {\n            return user._id === valUser;\n          });\n          data.colRole = dataUser.colaborador_role;\n          data.userID = dataUser._id;\n        }\n\n        if (data.sucursal !== 'null') {\n          data.sucursal = valSucursal;\n        }\n\n        this.pedidoService.busquedaBandejas(data).pipe(first()).subscribe(resp => {\n          this.pedidos = resp;\n        });\n      }));\n    }\n\n    cargarTodosPedidos() {\n      this.store.select('login').pipe(first()).subscribe(worker => {\n        this.pedidoService.obtenerPedidos(worker.token).subscribe(pedidos => {\n          // console.log(pedidos);\n          this.pedidos = pedidos;\n        });\n      });\n    }\n\n    limpiarForma() {\n      // this.forma.reset();\n      this.forma.controls.selBandeja.setValue('null');\n      this.forma.controls.sucursal.setValue('null');\n      this.forma.controls.usuarios.setValue('null');\n      this.usuarios = [];\n    }\n\n    formularioFake() {\n      this.forma = this.fb.group({\n        selBandeja: ['null'],\n        sucursal: ['null'],\n        usuarios: ['null']\n      });\n    }\n\n    recibirPedidos(pedidos) {\n      this.pedidos.pedidosDB = pedidos;\n    }\n\n  }\n\n  MiBandejaComponent.ɵfac = function MiBandejaComponent_Factory(t) {\n    return new (t || MiBandejaComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Store), i0.ɵɵdirectiveInject(i3.SucursalService), i0.ɵɵdirectiveInject(i4.UserService), i0.ɵɵdirectiveInject(i5.PedidoService));\n  };\n\n  MiBandejaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MiBandejaComponent,\n    selectors: [[\"app-mi-bandeja\"]],\n    viewQuery: function MiBandejaComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.selectUser = _t.first);\n      }\n    },\n    decls: 21,\n    vars: 6,\n    consts: [[3, \"pedidos\", \"emitirPedidos\"], [\"id\", \"wrapper\"], [\"id\", \"wrap-craeciones\", 1, \"animate__animated\"], [\"wrapCreaciones\", \"\"], [\"id\", \"wrap-head\"], [\"id\", \"head-titulo\"], [1, \"fas\", \"fa-cogs\", 2, \"margin-right\", \"30px\"], [\"id\", \"wrap-body\"], [3, \"formGroup\", \"ngSubmit\"], [\"id\", \"body\"], [\"class\", \"ctrl-creacion\", 4, \"ngIf\"], [\"id\", \"wrap-buttons-creacion\"], [\"type\", \"submit\"], [\"type\", \"button\", 3, \"click\"], [3, \"pedidos\"], [1, \"ctrl-creacion\"], [1, \"col-sm-2\", \"col-form-label\"], [\"formControlName\", \"selBandeja\", 1, \"form-select\", 3, \"change\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"formControlName\", \"sucursal\", 1, \"form-select\", 3, \"change\"], [\"formControlName\", \"usuarios\", 1, \"form-select\"], [\"selectUser\", \"\"]],\n    template: function MiBandejaComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"app-busqueda\", 0);\n        i0.ɵɵlistener(\"emitirPedidos\", function MiBandejaComponent_Template_app_busqueda_emitirPedidos_0_listener($event) {\n          return ctx.recibirPedidos($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2, 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵelementStart(5, \"div\", 5);\n        i0.ɵɵelement(6, \"i\", 6);\n        i0.ɵɵelementStart(7, \"span\");\n        i0.ɵɵtext(8, \"Mi bandeja\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"div\", 7);\n        i0.ɵɵelementStart(10, \"form\", 8);\n        i0.ɵɵlistener(\"ngSubmit\", function MiBandejaComponent_Template_form_ngSubmit_10_listener() {\n          return ctx.aplicarFiltro(ctx.usuarios);\n        });\n        i0.ɵɵelementStart(11, \"div\", 9);\n        i0.ɵɵtemplate(12, MiBandejaComponent_div_12_Template, 5, 1, \"div\", 10);\n        i0.ɵɵtemplate(13, MiBandejaComponent_div_13_Template, 5, 1, \"div\", 10);\n        i0.ɵɵtemplate(14, MiBandejaComponent_div_14_Template, 7, 3, \"div\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 11);\n        i0.ɵɵelementStart(16, \"button\", 12);\n        i0.ɵɵtext(17, \"Buscar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"button\", 13);\n        i0.ɵɵlistener(\"click\", function MiBandejaComponent_Template_button_click_18_listener() {\n          return ctx.limpiarForma();\n        });\n        i0.ɵɵtext(19, \"Limpiar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(20, \"app-tabla-pedidos\", 14);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"pedidos\", ctx.pedidos);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"formGroup\", ctx.forma);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.role === \"SuperRole\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.role === \"SuperRole\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.role === \"SuperRole\");\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"pedidos\", ctx.pedidos);\n      }\n    },\n    directives: [i6.BusquedaComponent, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i7.NgIf, i8.TablaPedidosComponent, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.FormControlName, i7.NgForOf, i1.NgSelectOption, i1.ɵNgSelectMultipleOption],\n    styles: [\"@import\\\"https://fonts.googleapis.com/css2?family=Roboto&display=swap\\\";@import\\\"https://fonts.googleapis.com/css2?family=Nunito+Sans&display=swap\\\";html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%!important;background-color:#eff2f5!important;position:relative;overflow:auto}#wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;margin:120px auto;font-family:\\\"Nunito Sans\\\",sans-serif}.borde-rojo[_ngcontent-%COMP%]{border:1px solid tomato}#wrap-craeciones[_ngcontent-%COMP%]{width:800px;min-height:320px;background-color:#fff;padding:25px;box-shadow:1px 1px 4px 1px #cfcfcf;position:relative;margin:0 auto}#wrap-craeciones[_ngcontent-%COMP%]   #wrap-head[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}#wrap-craeciones[_ngcontent-%COMP%]   #head-titulo[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:\\\"Nunito Sans\\\",sans-serif;flex-direction:row;color:#006c60;text-shadow:1px 3px 3px #cecece;font-size:20px;font-weight:600}#wrap-craeciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:\\\"Nunito Sans\\\",sans-serif;flex-direction:row;outline:none;border:none;background-color:#00b19d;color:#e5e5e5;height:35px;padding:10px;border-radius:4px;box-shadow:1px 1px 3px 3px #cecece;transition:.3s all ease-in-out;font-size:14px}#wrap-craeciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#009f8d}#wrap-craeciones[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:7px;text-shadow:1px 3px 3px #cecece}#wrap-craeciones[_ngcontent-%COMP%]   .fa-plus[_ngcontent-%COMP%]{text-shadow:1px 1px 3px #a0a0a0}#wrap-craeciones[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > #body[_ngcontent-%COMP%]{display:grid;grid-template-columns:48% 48%;grid-row-gap:15px;margin-top:50px;width:100%;justify-content:space-between}#wrap-craeciones[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > #body[_ngcontent-%COMP%]   .ctrl-creacion[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start}#wrap-craeciones[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > #body[_ngcontent-%COMP%]   .ctrl-creacion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{outline:none;box-shadow:none;border-radius:0;border-top:0;border-left:0;border-right:0}#wrap-craeciones[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > #body[_ngcontent-%COMP%]   .ctrl-creacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:80px;margin-right:15px}#wrap-craeciones[_ngcontent-%COMP%]   #wrap-buttons-creacion[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:140px;box-shadow:none;border:1px solid #cccccc}#wrap-craeciones[_ngcontent-%COMP%]   #wrap-buttons-creacion[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:first-child{background-color:#fff;color:#00b19d}#wrap-craeciones[_ngcontent-%COMP%]   #wrap-buttons-creacion[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:first-child:hover{color:#004b43;font-weight:400}#wrap-buttons-creacion[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:320px;position:absolute;right:25px;bottom:35px}\"]\n  });\n  return MiBandejaComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}